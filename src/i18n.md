# nullpointer-i18n

> RequireJS-модуль интернационализации

## Философия

* Использование в качестве ключей для перевода естественный язык, например, русский.
* Поддержка контекста перевода, например,
перевод слова _ключ_ в английском языке может быть различным в зависимости от контекста:

    _clue_ - ключ к разгадке чего-либо, путеводная нить, улика;

    _feeder_ - приток реки, канал.

* Поддержка форм множественного числа.
* Простые сигнатуры функций:

    _tr('ключ'); // простой перевод

    _trc('ключ', 'к разгадке чего-либо'); // перевод с контекстом

    _trn('ключ/ключа/ключей', 123); // простой перевод с формами множественного числа

    _trnc('ключ/ключа/ключей', 321, 'к разгадке чего-либо'); // перевод с контекстом и с формами множественного числа

* Унифицированный перевод как в коде, так и в шаблонах.


## Использование

    // Импорт
    var i18n = require('i18n');

    // Конфигурирование
    i18n.setConfig({
        // Настройки шаблонизатора underscore.js для перевода шаблонов.
        // Должны отличаться от общих настроек шаблонизатора
        // (underscore или другого используемого для шаблонов),
        // т.к. смысл шаблонизации i18n:
        //   только перевести текст шаблона,
        //   а далее использовать переведённый шаблон с шаблонизатором по умолчанию
        templateSettings: {
            evaluate:       '',
            interpolate:    /\$\{([\s\S]+?)\}/g,
            escape:         ''
        },

        // Экранировать перевод?
        escape: false
    });

    // Установка бандла
    var bundleContent   = require('text!bundle.json'),
        bundleJSON      = $.parseJSON(bundleContent);

    i18n.setBundle(bundleJSON);

    // Функции перевода
    var t = i18n.translateFuncs;

    // Установка языка перевода
    i18n.setLang('en');

    // _tr - простой перевод
    t._tr('ключ'); // -> key

    // _trc - перевод с контекстом
    t._trc('ключ', 'к разгадке чего-либо'); // -> clue
    t._trc('ключ', 'ключ воды, приток реки'); // -> feeder

    // _trn - простой перевод с формами множественного числа
    t._trn('ключ/ключа/ключей', 0); // -> keys
    t._trn('ключ/ключа/ключей', 1); // -> key
    t._trn('ключ/ключа/ключей', 2); // -> keys
    t._trn('ключ/ключа/ключей', 5); // -> keys

    //_trnc - перевод с контекстом и с формами множественного числа
    t._trnc('ключ/ключа/ключей', 0, 'к разгадке чего-либо'); // -> clues
    t._trnc('ключ/ключа/ключей', 1, 'к разгадке чего-либо'); // -> clue
    t._trnc('ключ/ключа/ключей', 2, 'к разгадке чего-либо'); // -> clues
    t._trnc('ключ/ключа/ключей', 5, 'к разгадке чего-либо'); // -> clues

    // Установка языка перевода, являющегося базовым языком (языком ключей)
    // В данном случае как такового перевода нет, работают только формы множественного числа
    i18n.setLang('ru');

    // _tr - простой перевод
    t._tr('ключ'); // -> ключ

    // _trc - перевод с контекстом
    t._trc('ключ', 'к разгадке чего-либо'); // -> ключ
    t._trc('ключ', 'ключ воды, приток реки'); // -> ключ

    // _trn - простой перевод с формами множественного числа
    t._trn('ключ/ключа/ключей', 0); // -> ключей
    t._trn('ключ/ключа/ключей', 1); // -> ключ
    t._trn('ключ/ключа/ключей', 2); // -> ключа
    t._trn('ключ/ключа/ключей', 5); // -> ключей

    //_trnc - перевод с контекстом и с формами множественного числа
    t._trnc('ключ/ключа/ключей', 0, 'к разгадке чего-либо'); // -> ключей
    t._trnc('ключ/ключа/ключей', 1, 'к разгадке чего-либо'); // -> ключ
    t._trnc('ключ/ключа/ключей', 2, 'к разгадке чего-либо'); // -> ключа
    t._trnc('ключ/ключа/ключей', 5, 'к разгадке чего-либо'); // -> ключей


    // Перевод шаблона
    var template = require('text!template.html');

    // template ->
                    <div>
                        <p>${_tr('ключ')}</p>

                        <p>${_trc('ключ', 'к разгадке чего-либо')}</p>
                        <p>${_trc('ключ', 'ключ воды, приток реки')}</p>

                        <p>0 ${_trn('ключ/ключа/ключей', 0)}</p>
                        <p>1 ${_trn('ключ/ключа/ключей', 1)}</p>
                        <p>2 ${_trn('ключ/ключа/ключей', 2)}</p>
                        <p>5 ${_trn('ключ/ключа/ключей', 5)}</p>

                        <p>0 ${_trnc('ключ/ключа/ключей', 0, 'к разгадке чего-либо')}</p>
                        <p>1 ${_trnc('ключ/ключа/ключей', 1, 'к разгадке чего-либо')}</p>
                        <p>2 ${_trnc('ключ/ключа/ключей', 2, 'к разгадке чего-либо')}</p>
                        <p>5 ${_trnc('ключ/ключа/ключей', 5, 'к разгадке чего-либо')}</p>

                        <p>${_tr('корова')}</p>
                    </div>

    // ${...} - interpolate шаблонизатора underscore.js (см. Конфигурирование)

    i18n.setLang('en');

    var template_en = i18n.translateTemplate(template);

    // template_en ->
                    <div>
                        <p>key</p>

                        <p>clue</p>
                        <p>feeder</p>

                        <p>0 keys</p>
                        <p>1 key</p>
                        <p>2 keys</p>
                        <p>5 keys</p>

                        <p>0 clues</p>
                        <p>1 clue</p>
                        <p>2 clues</p>
                        <p>5 clues</p>

                        <p>cow</p>
                    </div>


    i18n.setLang('ru');

    var template_ru = i18n.translateTemplate(template);

    // template_ru ->
                    <div>
                        <p>ключ</p>

                        <p>ключ</p>
                        <p>ключ</p>

                        <p>0 ключей</p>
                        <p>1 ключ</p>
                        <p>2 ключа</p>
                        <p>5 ключей</p>

                        <p>0 ключей</p>
                        <p>1 ключ</p>
                        <p>2 ключа</p>
                        <p>5 ключей</p>

                        <p>корова</p>
                    </div>


## Формат бандла перевода

    {
        // Для базового языка (языка ключей перевода)
        "ru": {
            // Заголовок
            "": {
                // Описание форм множественного числа
                // http://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html
                "pluralForms": {
                    // Кол-во форм
                    "count": 3,

                    // C-like код вычисления индекса формы
                    "ruleCode": "n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2",

                    // CLDR формат
                    // http://unicode.org/repos/cldr-tmp/trunk/diff/supplemental/language_plural_rules.html
                    "cldrFormat": "one{0}few{1}many{2}other{2}"
                }
            },

            // Сообщения по ключу
            "ключ": [
                // Зарезервированно для простого множественного числа. В данный момент не используется.
                null,

                // Единственное число при формах множественного числа (форма 0).
                "ключ",

                // Множественное число при формах множественного числа (форма 1).
                "ключа",

                // Множественное число при формах множественного числа (форма 2).
                "ключей"
            ],

            // Сообщения по ключу и контексту
            "к разгадке чего-либо\u0004ключ": [
                // Зарезервированно для простого множественного числа. В данный момент не используется.
                null,

                // Единственное число при формах множественного числа (форма 0).
                "ключ",

                // Единственное число при формах множественного числа (форма 1).
                "ключа",

                // Единственное число при формах множественного числа (форма 2).
                "ключей"
            ],

            // Сообщение по ключу. Ключ и является сообщением.
            "корова": [
                null
            ]
        },

        // Для языка перевода
        "en": {
            "": {
                // Описание форм множественного числа
                "pluralForms": {
                    "count": 2,
                    "ruleCode": "n != 1",
                    "cldrFormat": "one{0}other{1}"
                }
            },

            // Сообщения по ключу
            "ключ": [
                null,

                // Сообщение по ключу и единственное число при формах множественного числа (форма 0).
                "key",

                // Множественное число при формах множественного числа (форма 1).
                "keys"
            ],

            // Сообщения по ключу и контексту
            "к разгадке чего-либо\u0004ключ": [
                null,
                "clue",
                "clues"
            ],

            // Сообщение по ключу. При формировании бандла не были сформированы формы множественного числа для данного ключа.
            "корова": [
                null,
                "cow"
            ]
        }
    }

